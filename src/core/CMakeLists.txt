cmake_minimum_required(VERSION 3.16)
project(core LANGUAGES CXX)

set(AUTOMOC ON)
set(AUTOUIC ON)
set(AUTORCC ON)
set(CMAKE_AUTOMOC ON)
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Get all source files
file(GLOB_RECURSE CONTROLLER_HEADERS "controllers/*.h")
file(GLOB_RECURSE FEATURE_HEADERS "features/*.h")
file(GLOB_RECURSE INTERFACES_HEADERS "interfaces/*.h")
file(GLOB_RECURSE PRESETS_HEADERS "presets/*.h")
file(GLOB_RECURSE CONTROLLER_CPP "controllers/*.cpp")
file(GLOB_RECURSE FEATURE_CPP "features/*.cpp")
file(GLOB_RECURSE INTERFACES_CPP "interfaces/*.cpp")
file(GLOB_RECURSE PRESETS_CPP "presets/*.cpp")

# Create the Core QML module
qt_add_qml_module(${PROJECT_NAME}
    URI ${PROJECT_NAME}
    VERSION 1.0
    SHARED
    OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/qml/core"
    SOURCES
        ${CONTROLLER_HEADERS}
        ${FEATURE_HEADERS}
        ${INTERFACES_HEADERS}
        ${PRESETS_HEADERS}
        ${CONTROLLER_CPP}
        ${FEATURE_CPP}
        ${INTERFACES_CPP}
        ${PRESETS_CPP}
)



# CRITICAL: Make sure the autogenerated QML type registration file can find all headers
target_include_directories(${PROJECT_NAME}
    PUBLIC
        ${CMAKE_CURRENT_SOURCE_DIR}
    PRIVATE
        ${CMAKE_CURRENT_SOURCE_DIR}/controllers
        ${CMAKE_CURRENT_SOURCE_DIR}/features
        ${CMAKE_CURRENT_SOURCE_DIR}/interfaces
        ${CMAKE_CURRENT_SOURCE_DIR}/presets
        ${CMAKE_CURRENT_SOURCE_DIR}/controllers/MainController
        ${CMAKE_CURRENT_SOURCE_DIR}/controllers/ClipController
        ${CMAKE_CURRENT_SOURCE_DIR}/controllers/PluginController
        ${CMAKE_CURRENT_SOURCE_DIR}/controllers/PresetsController
        ${CMAKE_CURRENT_SOURCE_DIR}/controllers/ProcessingController
        ${CMAKE_CURRENT_SOURCE_DIR}/controllers/RecordingController
        ${CMAKE_CURRENT_SOURCE_DIR}/controllers/SourceController
        ${CMAKE_CURRENT_SOURCE_DIR}/yolo_models
)

# Link Qt libraries
target_link_libraries(${PROJECT_NAME}
    PUBLIC 
        Qt6::Core
        Qt6::Multimedia
        Qt6::Qml
        Qt6::Concurrent
)

# Export symbols on Windows
set_target_properties(${PROJECT_NAME} PROPERTIES
    WINDOWS_EXPORT_ALL_SYMBOLS ON
)

# Make the QML module available to importers
set_target_properties(${PROJECT_NAME} PROPERTIES
    QT_QML_MODULE_URI ${PROJECT_NAME}
    QT_QML_MODULE_VERSION 1.0
)
